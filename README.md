# EPUB Reader - Chrome 扩展

一个功能完善的 Chrome 浏览器扩展程序，用于上传、管理和阅读 EPUB 格式的电子书。支持本地存储、阅读进度保存、主题切换、字体大小调节等功能。

## 📚 项目简介

EPUB Reader 是一个基于 Chrome Extension Manifest V3 开发的电子书阅读器扩展。它允许用户在浏览器中直接上传、存储和阅读 EPUB 格式的电子书，无需安装额外的桌面应用程序。所有数据都存储在本地，保护用户隐私。

## ✨ 主要功能

### 1. 书籍管理

-   **上传 EPUB 文件**：支持通过点击按钮或拖拽方式上传 EPUB 格式的电子书
-   **书籍列表展示**：以卡片形式展示所有已上传的书籍，包含封面、标题、作者等信息
-   **书籍搜索**：支持按书名或作者搜索书籍
-   **书籍删除**：可以删除不需要的书籍

### 2. 阅读功能

-   **流畅阅读体验**：基于 EPUB.js 实现的高性能电子书渲染
-   **目录导航**：支持查看和跳转到书籍目录
-   **页码显示**：实时显示当前阅读页码（格式：当前页 / 总页数）
-   **阅读进度保存**：自动保存阅读进度，下次打开自动定位到上次阅读位置
-   **键盘翻页**：支持使用左右方向键快速翻页

### 3. 个性化设置

-   **字体大小调节**：支持增大（A+）和减小（A-）字体大小，范围 12px-24px
-   **主题切换**：支持亮色/暗色主题切换，保护眼睛
-   **设置持久化**：字体大小和主题设置会自动保存，下次打开自动应用

### 4. 性能优化

-   **快速加载**：内容优先显示，位置信息后台生成，大幅提升加载速度
-   **异步处理**：目录加载和配置加载并行处理，不阻塞主流程
-   **智能缓存**：使用 IndexedDB 和 localStorage 双重存储，确保数据安全

### 5. 用户体验

-   **加载动画**：优雅的加载提示，提升用户体验
-   **响应式设计**：适配不同屏幕尺寸，支持移动端使用
-   **错误处理**：完善的错误提示和处理机制

## 🛠️ 技术栈

-   **前端框架**：原生 JavaScript (ES6+)
-   **EPUB 解析**：EPUB.js
-   **文件处理**：JSZip
-   **数据存储**：
    -   IndexedDB（书籍数据存储）
    -   localStorage（阅读进度和设置）
-   **浏览器 API**：Chrome Extension Manifest V3

## 📁 项目结构

```
epubReader/
├── manifest.json          # Chrome 扩展配置文件
├── background/            # 后台脚本
│   └── background.js      # Service Worker，处理文件上传和资源缓存
├── popup/                 # 弹出窗口
│   ├── popup.html         # 主界面 HTML
│   ├── popup.css          # 样式文件
│   └── popup.js           # 业务逻辑：书籍管理、上传等
├── reader/                # 阅读器页面
│   ├── reader.html        # 阅读界面 HTML
│   ├── reader.css         # 阅读器样式
│   └── reader.js          # 阅读器逻辑：翻页、设置等
├── lib/                   # 第三方库
│   ├── epub.min.js        # EPUB.js 核心库
│   └── jszip.min.js       # JSZip 压缩文件处理库
├── icons/                 # 图标资源
│   ├── icon16.png
│   ├── icon48.png
│   ├── icon128.png
│   ├── left-arrow.png     # 左翻页箭头
│   ├── right-arrow.png    # 右翻页箭头
│   └── upload.svg         # 上传图标
└── README.md              # 项目说明文档
```

## 🚀 安装使用

### 开发环境安装

1. **克隆或下载项目**

    ```bash
    git clone <repository-url>
    cd epubReader
    ```

2. **加载扩展**

    - 打开 Chrome 浏览器
    - 访问 `chrome://extensions/`
    - 开启"开发者模式"
    - 点击"加载已解压的扩展程序"
    - 选择项目根目录

3. **使用扩展**
    - 点击浏览器工具栏中的扩展图标
    - 在弹出窗口中点击"选择文件"上传 EPUB 文件
    - 上传成功后，点击书籍卡片开始阅读

### 使用说明

#### 上传书籍

1. 点击扩展图标打开弹出窗口
2. 点击"选择文件"按钮或直接将 EPUB 文件拖拽到上传区域
3. 等待上传完成，书籍会自动添加到书库

#### 阅读书籍

1. 在书库中点击要阅读的书籍
2. 使用左右箭头按钮或键盘方向键翻页
3. 点击"目录"按钮查看和跳转章节
4. 使用 A+/A- 按钮调节字体大小
5. 点击主题按钮切换亮色/暗色模式

#### 管理书籍

-   **搜索**：在搜索框中输入书名或作者名
-   **删除**：点击书籍卡片上的删除按钮（🗑️）

## 📦 打包发布

### 打包命令

在项目根目录执行以下命令，将项目打包成 zip 压缩包：

#### 方法一：基本打包命令（推荐）

```bash
# 进入项目根目录
cd epubReader

# 打包命令（排除 .git、.DS_Store 等文件）
zip -r epubReader.zip . \
  -x "*.git/*" \
  -x "*.DS_Store" \
  -x "*.zip" \
  -x "*node_modules/*" \
  -x "*.log" \
  -x "*.swp" \
  -x "*.swo" \
  -x "*~"
```

#### 方法二：带时间戳的打包命令

如果需要生成带时间戳的压缩包（便于版本管理）：

```bash
# 进入项目根目录
cd epubReader

# 生成带时间戳的压缩包
TIMESTAMP=$(date +%Y%m%d_%H%M%S)
zip -r epubReader_${TIMESTAMP}.zip . \
  -x "*.git/*" \
  -x "*.DS_Store" \
  -x "*.zip" \
  -x "*node_modules/*" \
  -x "*.log" \
  -x "*.swp" \
  -x "*.swo" \
  -x "*~"
```

#### 方法三：一键打包脚本

也可以创建一个打包脚本 `package.sh`：

```bash
#!/bin/bash
# 打包脚本

# 获取项目目录
PROJECT_DIR="$(cd "$(dirname "$0")" && pwd)"
cd "$PROJECT_DIR"

# 生成时间戳
TIMESTAMP=$(date +%Y%m%d_%H%M%S)

# 打包
zip -r epubReader_${TIMESTAMP}.zip . \
  -x "*.git/*" \
  -x "*.DS_Store" \
  -x "*.zip" \
  -x "*node_modules/*" \
  -x "*.log" \
  -x "*.swp" \
  -x "*.swo" \
  -x "*~" \
  -x "package.sh"

echo "打包完成: epubReader_${TIMESTAMP}.zip"
```

使用方式：

```bash
chmod +x package.sh
./package.sh
```

### 打包说明

-   **打包格式**：ZIP 压缩包
-   **输出位置**：项目根目录
-   **排除文件**：
    -   `.git/` - Git 版本控制文件
    -   `.DS_Store` - macOS 系统文件
    -   `*.zip` - 已存在的压缩包
    -   `node_modules/` - Node.js 依赖（如果有）
    -   `*.log` - 日志文件
    -   `*.swp`, `*.swo`, `*~` - 编辑器临时文件

### 发布到 Chrome Web Store

1. 使用上述命令打包项目
2. 登录 [Chrome Web Store 开发者控制台](https://chrome.google.com/webstore/devconsole)
3. 创建新项目或更新现有项目
4. 上传打包好的 ZIP 文件
5. 填写扩展信息、截图、描述等
6. 提交审核

## 🔧 开发说明

### 核心模块

#### 1. Background Service Worker (`background/background.js`)

-   处理大文件上传（分块处理）
-   资源缓存管理
-   消息传递处理

#### 2. Popup 界面 (`popup/`)

-   书籍列表展示
-   文件上传处理
-   书籍搜索和删除
-   IndexedDB 数据管理

#### 3. Reader 阅读器 (`reader/`)

-   EPUB 文件解析和渲染
-   阅读进度管理
-   主题和字体设置
-   目录导航
-   键盘快捷键支持

### 数据存储

-   **IndexedDB**：存储书籍元数据（标题、作者、封面、文件数据等）
-   **localStorage**：存储阅读进度和用户设置（字体大小、主题等）

### 性能优化

1. **异步加载**：内容优先显示，位置信息后台生成
2. **并行处理**：目录和配置并行加载
3. **智能缓存**：使用双重存储机制确保数据安全
4. **降低精度**：位置信息生成使用较大间隔（5000），提升速度

## 📝 功能特性详解

### 阅读进度

-   自动保存：每次翻页自动保存阅读位置
-   双重存储：localStorage（快速） + IndexedDB（持久化）
-   页码显示：实时显示当前页码（格式：当前页 / 总页数）
-   自动恢复：打开书籍时自动定位到上次阅读位置

### 主题切换

-   亮色主题：白色背景，适合白天阅读
-   暗色主题：深色背景，适合夜间阅读
-   设置持久化：主题选择自动保存

### 字体调节

-   范围：12px - 24px
-   步进：1px
-   实时预览：调整后立即生效
-   设置保存：字体大小自动保存

### 目录导航

-   自动解析：从 EPUB 文件中提取目录
-   快速跳转：点击目录项直接跳转到对应章节
-   侧边栏展示：支持打开/关闭目录面板

## 🐛 已知问题

-   页码信息需要等待内容渲染完成后才能获取
-   大型 EPUB 文件的位置信息生成可能需要较长时间（后台异步处理）

## 🔮 未来计划

-   [ ] 支持 EPUB 2.0 和 EPUB 3.0 完整特性
-   [ ] 添加书签功能
-   [ ] 支持高亮和笔记
-   [ ] 添加阅读统计（阅读时长、阅读进度等）
-   [ ] 支持导出阅读记录
-   [ ] 添加更多主题选项
-   [ ] 支持自定义字体
-   [ ] 添加阅读模式（单页/双页/滚动）

## 📄 许可证

本项目采用 MIT 许可证。

## 👥 贡献

欢迎提交 Issue 和 Pull Request！

## 📧 联系方式

如有问题或建议，请通过 Issue 联系。

---

**版本**：1.0  
**最后更新**：2025 年 11 月
